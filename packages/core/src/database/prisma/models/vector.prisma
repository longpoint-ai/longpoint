model VectorProviderConfig {
  id         String   @id @default(cuid(2))
  providerId String   @unique
  config     Json?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model VectorIndex {
  id               String   @id @default(cuid(2))
  name             String   @unique
  /// Fully qualified model ID of the embedding model to use for this index. `null` implies the vector provider is capable of embedding documents without an external model.
  embeddingModelId String?
  /// Vector database provider ID
  vectorProviderId String
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  documents VectorDocument[]

  @@index([embeddingModelId])
  @@index([vectorProviderId])
}

model VectorDocument {
  id           String               @id @default(cuid(2))
  /// Direct storage of the embedding vector
  // embedding    Unsupported("vector")?
  /// Original document metadata
  metadata     Json?
  status       VectorDocumentStatus @default(PENDING)
  errorMessage String?
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt

  indexId          String
  index            VectorIndex    @relation(fields: [indexId], references: [id], onDelete: Cascade)
  mediaContainerId String         @unique
  mediaContainer   MediaContainer @relation(fields: [mediaContainerId], references: [id], onDelete: Cascade)

  @@index([indexId])
  @@index([status])
  @@index([mediaContainerId])
}

enum VectorDocumentStatus {
  PENDING
  INDEXING
  INDEXED
  FAILED
}
